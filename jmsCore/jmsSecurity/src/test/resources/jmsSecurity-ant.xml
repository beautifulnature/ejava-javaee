<?xml version="1.0" encoding="UTF-8"?>
<project name="jmsSecurity" default="run" basedir="..">

    <property file="test-classes/${ant.project.name}.properties"/>

    <path id="demo.classpath">
        <pathelement path="${commons.logging.classpath}"/>
        <pathelement path="${log4j.classpath}"/>
        <pathelement path="${javaee.classpath}"/>
        <pathelement path="${jbossall-client.classpath}"/>
        <pathelement path="test-classes"/>
        <pathelement path="classes"/>
        <pathelement path="${jmsScheduler.classpath}"/>
    </path>

    <description>
    This demo is under construction...
    </description>

    <target name="echo">
        <property name="demo-classpath" refid="demo.classpath"/>
        <echo>basedir=${basedir}</echo>
        <echo>commons.logging.classpath=${commons.logging.classpath}</echo>
        <echo>jmsScheduler.classpath=${jmsScheduler.classpath}</echo>
        <echo>demo.classpath=${demo-classpath}</echo>
    </target>

    <target name="init">
        <copy todir="${JBOSS_HOME}/server/default/deploy"
              file="test-classes/${ant.project.name}-jms-service.xml"/>
        <sleep seconds="5"/>
    </target>

    <target name="requestor" depends="echo">
        <java classname="ejava.examples.jmssecurity.SecureRequestor"
            fork="true">
            <classpath>
                <path refid="demo.classpath"/>
            </classpath>
            <arg value="-jndi.name.connFactory"/>
            <arg value="${jndi.name.connFactory}"/>
            <arg value="-jndi.name.requestQueue"/>
            <arg value="${jndi.name.requestQueue}"/>
            <arg value="-jndi.name.responseQueue"/>
            <arg value="${jndi.name.responseQueue}"/>
            <arg value="-jndi.name.DLQ"/>
            <arg value="${jndi.name.DLQ}"/>
            <arg value="-name"/>
            <arg value="${requestor.name}"/>
            <arg value="-sleep"/>
            <arg value="${requestor.sleep}"/>
            <arg value="-max"/>
            <arg value="${requestor.max}"/>

            <sysproperty key="java.security.auth.login.config"
                         value="${login.config.path}"/>

            <arg value="-loginConfig"/>
            <arg value="${loginConfig}"/>
            <arg value="-username"/>
            <arg value="${requestor.username}"/>
            <arg value="-password"/>
            <arg value="${requestor.password}"/>
        </java>
    </target>

    <target name="requestor1" depends="echo">
        <java classname="ejava.examples.jmssecurity.SecureRequestor"
            fork="true">
            <classpath>
                <path refid="demo.classpath"/>
            </classpath>
            <arg value="-jndi.name.connFactory"/>
            <arg value="${jndi.name.connFactory}"/>
            <arg value="-jndi.name.requestQueue"/>
            <arg value="${jndi.name.requestQueue}"/>
            <arg value="-jndi.name.responseQueue"/>
            <arg value="${jndi.name.responseQueue}"/>
            <arg value="-jndi.name.DLQ"/>
            <arg value="${jndi.name.DLQ}"/>
            <arg value="-name"/>
            <arg value="${requestor1.name}"/>
            <arg value="-sleep"/>
            <arg value="${requestor1.sleep}"/>
            <arg value="-max"/>
            <arg value="${requestor1.max}"/>

            <sysproperty key="java.security.auth.login.config"
                         value="${login.config.path}"/>

            <arg value="-loginConfig"/>
            <arg value="${loginConfig}"/>
            <arg value="-username"/>
            <arg value="${requestor1.username}"/>
            <arg value="-password"/>
            <arg value="${requestor1.password}"/>
        </java>
    </target>

    <target name="requestor2" depends="echo">
        <java classname="ejava.examples.jmssecurity.SecureRequestor"
            fork="true">
            <classpath>
                <path refid="demo.classpath"/>
            </classpath>
            <arg value="-jndi.name.connFactory"/>
            <arg value="${jndi.name.connFactory}"/>
            <arg value="-jndi.name.requestQueue"/>
            <arg value="${jndi.name.requestQueue}"/>
            <arg value="-jndi.name.responseQueue"/>
            <arg value="${jndi.name.responseQueue}"/>
            <arg value="-jndi.name.DLQ"/>
            <arg value="${jndi.name.DLQ}"/>
            <arg value="-name"/>
            <arg value="${requestor2.name}"/>
            <arg value="-sleep"/>
            <arg value="${requestor2.sleep}"/>
            <arg value="-max"/>
            <arg value="${requestor2.max}"/>

            <sysproperty key="java.security.auth.login.config"
                         value="${login.config.path}"/>

            <arg value="-loginConfig"/>
            <arg value="${loginConfig}"/>
            <arg value="-username"/>
            <arg value="${requestor2.username}"/>
            <arg value="-password"/>
            <arg value="${requestor2.password}"/>
        </java>
    </target>

    <target name="worker" depends="echo">
        <java classname="ejava.examples.jmssecurity.SecureWorker"
            fork="true">
            <classpath>
                <path refid="demo.classpath"/>
            </classpath>
            <arg value="-jndi.name.connFactory"/>
            <arg value="${jndi.name.connFactory}"/>
            <arg value="-jndi.name.destination"/>
            <arg value="${jndi.name.requestQueue}"/>
            <arg value="-jndi.name.DLQ"/>
            <arg value="${jndi.name.DLQ}"/>
            <arg value="-name"/>
            <arg value="${worker.name}"/>
            <arg value="-max"/>
            <arg value="${worker.max}"/>

            <sysproperty key="java.security.auth.login.config"
                         value="${login.config.path}"/>

            <arg value="-loginConfig"/>
            <arg value="${loginConfig}"/>
            <arg value="-username"/>
            <arg value="${worker.username}"/>
            <arg value="-password"/>
            <arg value="${worker.password}"/>
        </java>
    </target>

    <target name="worker1" depends="echo">
        <java classname="ejava.examples.jmssecurity.SecureWorker"
            fork="true">
            <classpath>
                <path refid="demo.classpath"/>
            </classpath>
            <arg value="-jndi.name.connFactory"/>
            <arg value="${jndi.name.connFactory}"/>
            <arg value="-jndi.name.destination"/>
            <arg value="${jndi.name.requestQueue}"/>
            <arg value="-jndi.name.DLQ"/>
            <arg value="${jndi.name.DLQ}"/>
            <arg value="-name"/>
            <arg value="${worker1.name}"/>
            <arg value="-max"/>
            <arg value="${worker1.max}"/>

            <sysproperty key="java.security.auth.login.config"
                         value="${login.config.path}"/>

            <arg value="-loginConfig"/>
            <arg value="${loginConfig}"/>
            <arg value="-username"/>
            <arg value="${worker1.username}"/>
            <arg value="-password"/>
            <arg value="${worker1.password}"/>
        </java>
    </target>

    <target name="worker2" depends="echo">
        <java classname="ejava.examples.jmssecurity.SecureWorker"
            fork="true">
            <classpath>
                <path refid="demo.classpath"/>
            </classpath>
            <arg value="-jndi.name.connFactory"/>
            <arg value="${jndi.name.connFactory}"/>
            <arg value="-jndi.name.destination"/>
            <arg value="${jndi.name.requestQueue}"/>
            <arg value="-jndi.name.DLQ"/>
            <arg value="${jndi.name.DLQ}"/>
            <arg value="-name"/>
            <arg value="${worker2.name}"/>
            <arg value="-max"/>
            <arg value="${worker2.max}"/>

            <sysproperty key="java.security.auth.login.config"
                         value="${login.config.path}"/>

            <arg value="-loginConfig"/>
            <arg value="${loginConfig}"/>
            <arg value="-username"/>
            <arg value="${worker2.username}"/>
            <arg value="-password"/>
            <arg value="${worker2.password}"/>
        </java>
    </target>
</project>
