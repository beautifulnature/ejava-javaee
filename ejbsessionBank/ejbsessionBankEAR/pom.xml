<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">

    <parent>
        <artifactId>ejbsessionBank</artifactId>
        <groupId>ejava.javaee.ejb</groupId>
        <version>1.0.2010.2-SNAPSHOT</version>
    </parent>

  <modelVersion>4.0.0</modelVersion>
  <artifactId>ejbsessionBankEAR</artifactId>
  <packaging>ear</packaging>
  <name>Session Bank EAR</name>
  <description>
    This projects provides an example EAR for the EJB Session Bank Project.
    This EAR is assembled here, but tested as a part of the
    function/integration testing in a sibling project.
  </description>

    <dependencies>
        <dependency>
            <groupId>${pom.groupId}</groupId>
            <artifactId>ejbsessionBankEJB</artifactId>
            <version>${pom.version}</version>
            <type>ejb</type>
            <exclusions>
                <exclusion>
                    <groupId>commons-logging</groupId>
                    <artifactId>commons-logging</artifactId>
                </exclusion>
            </exclusions>
        </dependency>

        <dependency>
            <groupId>${pom.groupId}</groupId>
            <artifactId>ejbsessionBankWAR</artifactId>
            <version>${pom.version}</version>
            <type>war</type>
        </dependency>
    </dependencies>

    <build>
        <plugins>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-ear-plugin</artifactId>
                <configuration>
                    <description>
                        Example Session Bean Bank Application
                    </description>
                    <modules>
                        <webModule>
                            <groupId>${pom.groupId}</groupId>
                            <artifactId>ejbsessionBankWAR</artifactId>
                            <contextRoot>ejbsessionBank</contextRoot>
                        </webModule>
                    </modules>
                </configuration>
            </plugin>
        </plugins>
    </build>

<profiles>
    <!-- this profiles allow the EAR to be undeployed before it is deleted
        during the clean target. This behavior requires the EAR to be
        present, so it cannot be part of the default behavior. It is
        only activated when -Dundeploy or -Pundeploy is present so that
        normal cleans do not fail.  -->
<profile>
    <id>undeploy</id>
    <activation>
        <property>
            <name>undeploy</name>
            <value>true</value>
        </property>
    </activation>    
    <build>
        <plugins>
        <plugin>
            <groupId>org.codehaus.cargo</groupId>
            <artifactId>cargo-maven2-plugin</artifactId>
            <configuration>
                <container>
                    <containerId>jboss4x</containerId>
                    <type>remote</type>                
                </container>
            </configuration>
            <executions>
                <execution>
                    <id>undeploy-ear</id>
                    <phase>pre-clean</phase>
                    <goals>
                        <goal>undeploy</goal>
                    </goals>
                    <configuration>
                        <configuration>
                            <type>runtime</type>
                            <properties>
                            <cargo.remote.username>${jboss.user}</cargo.remote.username>
                            <cargo.remote.password>${jboss.password}</cargo.remote.password>
                            </properties>
                        </configuration>
                        <deployer>
                            <type>remote</type>
                            <deployables>
                                <deployable>
                                    <groupId>${pom.groupId}</groupId>
                                    <artifactId>${pom.artifactId}</artifactId>
                                    <type>ear</type>
                                </deployable>
                            </deployables>
                        </deployer>
                    </configuration>
                </execution>
            </executions>
        </plugin>                    
        </plugins>
    </build>
</profile>
    </profiles>
</project>
